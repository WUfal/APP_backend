<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词拆分 - 算法可视化</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .cell-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

        /* DP 状态激活动画 */
        .dp-active { animation: pulseGreen 0.5s ease-out forwards; }
        @keyframes pulseGreen {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        /* 字典匹配动画 */
        .dict-match { animation: flashYellow 0.5s ease-out; }
        @keyframes flashYellow {
            0% { background-color: #fef08a; }
            100% { background-color: white; }
        }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- 图标组件 ---
    const Icons = {
        Play: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
        Pause: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>,
        Step: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
        Reset: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /></svg>,
        Settings: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
        Shuffle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
    };

    const App = () => {
        // --- 状态定义 ---
        const [inputStr, setInputStr] = useState("leetcode");
        const [dictStr, setDictStr] = useState("leet, code");

        // 核心数据
        const [s, setS] = useState("leetcode");
        const [dict, setDict] = useState(["leet", "code"]);
        const [dp, setDp] = useState([true]); // dp[i] means s[0...i] valid

        // 算法指针
        const [i, setI] = useState(1); // 外层循环 1 to n
        const [j, setJ] = useState(0); // 内层循环 0 to i-1

        // 运行控制
        const [isPlaying, setIsPlaying] = useState(false);
        const [isFinished, setIsFinished] = useState(false);
        const [message, setMessage] = useState("准备就绪");
        const [msgColor, setMsgColor] = useState("text-slate-600");

        // 动画状态
        const [matchedWord, setMatchedWord] = useState(null); // 当前匹配到的单词

        const timerRef = useRef(null);

        // --- 初始化 ---
        const reset = (str = s, dStr = dictStr) => {
            setIsPlaying(false);
            setIsFinished(false);

            setS(str);
            const d = dStr.split(/[,，\s]+/).filter(w => w.length > 0);
            setDict(d);

            // DP init: dp[0] = true, others false
            const newDp = new Array(str.length + 1).fill(false);
            newDp[0] = true;
            setDp(newDp);

            setI(1);
            setJ(0);
            setMatchedWord(null);
            setMessage("DP[0] 初始化为 True (空串)。准备开始推导。");
            setMsgColor("text-slate-600");

            if (timerRef.current) clearInterval(timerRef.current);
        };

        const loadInput = () => {
            if (!inputStr || !dictStr) return;
            reset(inputStr, dictStr);
        };

        const randomInput = () => {
            const pools = [
                { s: "applepenapple", d: "apple, pen" },
                { s: "catsandog", d: "cats, dog, sand, and, cat" },
                { s: "aaaaaaa", d: "aaaa, aaa" },
                { s: "goals", d: "go, als" }
            ];
            const rand = pools[Math.floor(Math.random() * pools.length)];
            setInputStr(rand.s);
            setDictStr(rand.d);
            reset(rand.s, rand.d);
        };

        useEffect(() => {
            reset();
        }, []);

        // --- 核心算法逻辑 (Step) ---
        const stepForward = () => {
            if (isFinished) return;

            // 检查是否全部完成
            if (i > s.length) {
                setIsFinished(true);
                setIsPlaying(false);
                const result = dp[s.length];
                setMessage(result ? "成功！字符串可以被成功拆分。" : "失败！字符串无法被拆分。");
                setMsgColor(result ? "text-green-600" : "text-red-600");
                return;
            }

            // 内层循环结束，移动外层
            if (j >= i) {
                if (!dp[i]) {
                    setMessage(`索引 ${i} 处未能找到匹配分割点。继续下一个位置。`);
                    setMsgColor("text-slate-500");
                }
                setI(i + 1);
                setJ(0);
                setMatchedWord(null);
                return;
            }

            // 核心检查逻辑： Check s[j...i-1]
            // 需要满足两个条件: 1. dp[j] is true, 2. s[j...i-1] in dict

            const subStr = s.substring(j, i);
            const isDpJTrue = dp[j];
            const inDict = dict.includes(subStr);

            if (isDpJTrue && inDict) {
                // Found a valid split!
                const newDp = [...dp];
                newDp[i] = true;
                setDp(newDp);
                setMatchedWord(subStr);

                setMessage(`DP[${j}]为真 且 "${subStr}" 在字典中 -> 标记 DP[${i}] = True。`);
                setMsgColor("text-green-600");

                // Break inner loop (optimization)
                setI(i + 1);
                setJ(0); // Reset for next i
            } else {
                // Continue checking next j
                let reason = "";
                if (!isDpJTrue) reason = `DP[${j}] 为 False (前缀不可拆分)`;
                else if (!inDict) reason = `"${subStr}" 不在字典中`;

                setMessage(`检查子串 "${subStr}" ([${j}, ${i}]): ${reason}。跳过。`);
                setMsgColor("text-slate-500");
                setMatchedWord(null);
                setJ(j + 1);
            }
        };

        // --- 自动播放 ---
        useEffect(() => {
            if (isPlaying && !isFinished) {
                timerRef.current = setInterval(() => {
                    stepForward();
                }, 800); // 速度
            }
            return () => clearInterval(timerRef.current);
        }, [isPlaying, isFinished, i, j, dp, s, dict]);

        // --- 渲染辅助 ---

        const getCharClass = (idx) => {
            let base = "w-10 h-10 flex items-center justify-center border rounded font-mono text-lg font-bold relative cell-transition ";

            // Substring Highlight: [j ... i-1]
            // Note: Current logic checks substring s[j...i-1], so indices j to i-1
            if (!isFinished && idx >= j && idx < i) {
                base += "bg-indigo-100 border-indigo-400 text-indigo-800 ";
            } else {
                base += "bg-white border-slate-200 text-slate-400 ";
            }

            return base;
        };

        const getDpClass = (idx) => {
            let base = "w-10 h-10 flex items-center justify-center border rounded font-mono text-sm font-bold relative cell-transition mt-2 ";

            if (dp[idx]) {
                base += "bg-green-100 border-green-500 text-green-700 dp-active ";
            } else {
                base += "bg-slate-50 border-slate-200 text-slate-300 ";
            }

            // Pointers
            if (!isFinished) {
                if (idx === i) base += "ring-2 ring-indigo-500 ring-offset-1 ";
                if (idx === j) base += "ring-2 ring-amber-400 ring-offset-1 ";
            }

            return base;
        };

        return (
            <div className="max-w-4xl mx-auto p-4 sm:p-6">
                {/* 1. 顶部配置 */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
                    <div className="flex items-center gap-2 mb-3 text-slate-700 font-bold">
                        <Icons.Settings />
                        <span>数据配置</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label className="text-xs text-slate-400 font-bold uppercase">字符串 (s)</label>
                            <input
                                type="text"
                                value={inputStr}
                                onChange={(e) => setInputStr(e.target.value)}
                                className="w-full border border-slate-300 rounded-lg px-3 py-2 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                placeholder="leetcode"
                            />
                        </div>
                        <div>
                            <label className="text-xs text-slate-400 font-bold uppercase">字典 (comma separated)</label>
                            <input
                                type="text"
                                value={dictStr}
                                onChange={(e) => setDictStr(e.target.value)}
                                className="w-full border border-slate-300 rounded-lg px-3 py-2 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                placeholder="leet, code"
                            />
                        </div>
                    </div>
                    <div className="flex gap-2 justify-end mt-3">
                        <button onClick={loadInput} className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium text-sm">
                            加载
                        </button>
                        <button onClick={randomInput} className="px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition" title="随机生成">
                            <Icons.Shuffle />
                        </button>
                    </div>
                </div>

                {/* 2. 主体区 */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">

                    {/* 左侧：可视化 */}
                    <div className="md:col-span-2 bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden flex flex-col">
                        <div className="border-b border-slate-100 bg-slate-50 p-4">
                            <h1 className="text-xl font-bold text-slate-800">单词拆分 (Word Break)</h1>
                            <p className="text-xs text-slate-500 mt-1">动态规划 · DP[i] = DP[j] && s[j:i] in Dict</p>
                        </div>

                        <div className="p-6 flex-1 flex flex-col items-center justify-center min-h-[300px] overflow-x-auto">

                            {/* String & DP Grid */}
                            <div className="flex flex-col gap-1">
                                {/* String Row */}
                                <div className="flex gap-1 mb-2">
                                    <div className="w-10 h-10 flex items-center justify-end text-xs font-bold text-slate-400 mr-2">Index</div>
                                    {s.split('').map((char, idx) => (
                                        <div key={idx} className="w-10 text-center text-xs text-slate-300 font-mono">{idx}</div>
                                    ))}
                                    <div className="w-10 text-center text-xs text-slate-300 font-mono">{s.length}</div>
                                </div>

                                <div className="flex gap-1">
                                    <div className="w-10 h-10 flex items-center justify-end text-xs font-bold text-indigo-500 mr-2">Char</div>
                                    {s.split('').map((char, idx) => (
                                        <div key={idx} className={getCharClass(idx)}>
                                            {char}
                                            {/* Pointers Labels */}
                                            {!isFinished && idx === j && <div className="absolute -top-5 text-[10px] text-amber-500 font-bold">j</div>}
                                            {!isFinished && idx === i-1 && <div className="absolute -top-5 text-[10px] text-indigo-500 font-bold">i-1</div>}
                                        </div>
                                    ))}
                                    {/* Empty slot for index n */}
                                    <div className="w-10 h-10 border border-dashed border-slate-200 rounded"></div>
                                </div>

                                {/* DP Row */}
                                <div className="flex gap-1">
                                    <div className="w-10 h-10 flex items-center justify-end text-xs font-bold text-green-600 mr-2">DP</div>
                                    {dp.map((val, idx) => (
                                        <div key={idx} className={getDpClass(idx)}>
                                            {val ? 'T' : 'F'}
                                            {/* Index Label for DP */}
                                            <span className="absolute -bottom-4 text-[9px] text-slate-300 font-normal">{idx}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                        </div>

                        {/* Controls */}
                        <div className="border-t border-slate-100 p-4 bg-white mt-auto">
                            <div className="flex flex-col gap-3">
                                <div className={`px-4 py-3 rounded-lg text-sm border-l-4 transition-colors bg-slate-50 border-slate-400 ${msgColor.replace('text-', 'border-').replace('600', '500')}`}>
                                    <span className={msgColor}>{message}</span>
                                </div>

                                <div className="flex items-center justify-center gap-2">
                                    <button onClick={() => setIsPlaying(!isPlaying)} disabled={isFinished} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-white font-medium transition ${isPlaying ? 'bg-slate-500 hover:bg-slate-600' : 'bg-indigo-600 hover:bg-indigo-700'} disabled:opacity-50`}>
                                        {isPlaying ? <Icons.Pause /> : <Icons.Play />}
                                        <span className="hidden sm:inline">{isPlaying ? "暂停" : "运行"}</span>
                                    </button>
                                    <button onClick={stepForward} disabled={isPlaying || isFinished} className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition disabled:opacity-50">
                                        <Icons.Step />
                                        <span className="hidden sm:inline">单步</span>
                                    </button>
                                    <button onClick={() => reset()} className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition" title="重置">
                                        <Icons.Reset />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 右侧：字典 */}
                    <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden flex flex-col max-h-[500px]">
                        <div className="border-b border-slate-100 bg-slate-50 p-4">
                            <h2 className="font-bold text-slate-700">字典 (Dictionary)</h2>
                        </div>
                        <div className="p-4 overflow-y-auto flex-1 bg-slate-50/50">
                            <div className="flex flex-wrap gap-2">
                                {dict.map((word, idx) => (
                                    <span key={idx}
                                          className={`px-3 py-1.5 rounded-full text-sm border transition-all duration-300
                                            ${matchedWord === word
                                              ? 'bg-green-500 text-white border-green-600 shadow-md scale-110'
                                              : 'bg-white text-slate-600 border-slate-200'}
                                        `}
                                    >
                                        {word}
                                    </span>
                                ))}
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>