<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº - ç®—æ³•å¯è§†åŒ–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .cell-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        /* ç®€å•çš„æ¡å½¢å›¾é«˜åº¦åŠ¨ç”» */
        .bar-enter { animation: growUp 0.5s ease-out forwards; }
        @keyframes growUp {
            from { height: 0; }
            to { height: var(--h); }
        }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- å›¾æ ‡ç»„ä»¶ ---
    const Icons = {
        Play: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
        Pause: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>,
        Step: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
        Reset: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /></svg>,
        Settings: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
        Shuffle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>,
        TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>,
        DollarSign: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
    };

    const App = () => {
        // --- çŠ¶æ€å®šä¹‰ ---
        const [inputStr, setInputStr] = useState("7, 1, 5, 3, 6, 4");
        const [prices, setPrices] = useState([7, 1, 5, 3, 6, 4]);
        const [mode, setMode] = useState("onepass"); // 'brute' | 'onepass'

        // è¿è¡ŒçŠ¶æ€
        const [isPlaying, setIsPlaying] = useState(false);
        const [isFinished, setIsFinished] = useState(false);
        const [message, setMessage] = useState("å‡†å¤‡å°±ç»ª");

        // é€šç”¨ç»“æœçŠ¶æ€
        const [maxProfit, setMaxProfit] = useState(0);
        const [bestBuyDay, setBestBuyDay] = useState(-1);
        const [bestSellDay, setBestSellDay] = useState(-1);

        // æš´åŠ›æ³•çŠ¶æ€ O(N^2)
        const [bruteBuy, setBruteBuy] = useState(0);
        const [bruteSell, setBruteSell] = useState(1);

        // ä¸€æ¬¡éå†æ³•çŠ¶æ€ O(N)
        const [currDay, setCurrDay] = useState(0);
        const [minPrice, setMinPrice] = useState(Infinity);
        const [minPriceIdx, setMinPriceIdx] = useState(-1);

        // --- åˆå§‹åŒ–/é‡ç½® ---
        const parseInput = () => {
            const arr = inputStr.split(/[,ï¼Œ\s]+/).filter(v => v.trim() !== "").map(Number);
            if (arr.length < 2) {
                setMessage("è‡³å°‘éœ€è¦ä¸¤å¤©çš„ä»·æ ¼æ•°æ®");
                return;
            }
            setPrices(arr);
            resetState();
            setMessage(`å·²åŠ è½½æ•°æ®ã€‚å¯»æ‰¾æœ€å¤§åˆ©æ¶¦ã€‚`);
        };

        const resetState = () => {
            setIsPlaying(false);
            setIsFinished(false);
            setMessage("çŠ¶æ€å·²é‡ç½®");

            setMaxProfit(0);
            setBestBuyDay(-1);
            setBestSellDay(-1);

            // Brute Reset
            setBruteBuy(0);
            setBruteSell(1);

            // One Pass Reset
            setCurrDay(0);
            setMinPrice(Infinity);
            setMinPriceIdx(-1);
        };

        const randomInput = () => {
            const len = 6 + Math.floor(Math.random() * 4); // 6-9 days
            const arr = Array.from({length: len}, () => Math.floor(Math.random() * 15) + 1);
            setInputStr(arr.join(", "));
            setPrices(arr);
            resetState();
            setMessage(`å·²ç”Ÿæˆéšæœºè‚¡ä»·æ•°æ®ã€‚`);
        };

        // --- è‡ªåŠ¨æ’­æ”¾ ---
        useEffect(() => {
            let timer;
            if (isPlaying && !isFinished) {
                timer = setInterval(() => {
                    stepForward();
                }, 800); // ç¨å¾®å¿«ä¸€ç‚¹
            }
            return () => clearInterval(timer);
        }, [isPlaying, isFinished, mode, prices, bruteBuy, bruteSell, currDay, minPrice]);

        const stepForward = () => {
            if (isFinished) return;
            if (mode === 'brute') {
                stepBrute();
            } else {
                stepOnePass();
            }
        };

        // 1. æš´åŠ›æ³• O(N^2)
        const stepBrute = () => {
            let b = bruteBuy;
            let s = bruteSell;

            if (b >= prices.length - 1) {
                setIsFinished(true);
                setIsPlaying(false);
                setMessage(`éå†ç»“æŸã€‚æœ€å¤§åˆ©æ¶¦ä¸º: ${maxProfit}`);
                return;
            }

            const profit = prices[s] - prices[b];
            let msg = `ä¹°å…¥(ç¬¬${b}å¤©): ${prices[b]}, å–å‡º(ç¬¬${s}å¤©): ${prices[s]}ã€‚`;

            if (profit > maxProfit) {
                setMaxProfit(profit);
                setBestBuyDay(b);
                setBestSellDay(s);
                msg += ` å‘ç°æ›´é«˜åˆ©æ¶¦: ${profit}ï¼æ›´æ–°è®°å½•ã€‚`;
            } else {
                msg += ` åˆ©æ¶¦: ${profit} (æœªè¶…è¿‡ ${maxProfit})ã€‚`;
            }
            setMessage(msg);

            // æŒ‡é’ˆç§»åŠ¨é€»è¾‘
            let nextS = s + 1;
            let nextB = b;

            if (nextS >= prices.length) {
                nextB = b + 1;
                nextS = nextB + 1;
                if (nextB >= prices.length - 1) {
                    // ä¸‹ä¸€æ­¥ä¼šç»“æŸ
                }
            }

            setBruteBuy(nextB);
            setBruteSell(nextS);
        };

        // 2. ä¸€æ¬¡éå†æ³• O(N)
        const stepOnePass = () => {
            let i = currDay;
            if (i >= prices.length) {
                setIsFinished(true);
                setIsPlaying(false);
                setMessage(`éå†ç»“æŸã€‚æœ€å¤§åˆ©æ¶¦ä¸º: ${maxProfit}`);
                return;
            }

            const currentPrice = prices[i];
            let msg = `ç¬¬ ${i} å¤© (ä»·æ ¼ ${currentPrice}): `;
            let newMinPrice = minPrice;
            let newMinIdx = minPriceIdx;

            if (currentPrice < minPrice) {
                newMinPrice = currentPrice;
                newMinIdx = i;
                setMinPrice(currentPrice);
                setMinPriceIdx(i);
                msg += `ğŸ“‰ å‘ç°æ›´ä½è‚¡ä»·ï¼æ›´æ–°æœ€ä½ä¹°å…¥ä»·ä¸º ${currentPrice}ã€‚`;
            } else {
                const profit = currentPrice - minPrice;
                msg += `å½“å‰å–å‡ºåˆ©æ¶¦ = ${currentPrice} - ${minPrice} = ${profit}ã€‚`;

                if (profit > maxProfit) {
                    setMaxProfit(profit);
                    setBestBuyDay(minPriceIdx); // è¿™é‡Œçš„ minPriceIdx æ˜¯ä¹‹å‰çš„
                    setBestSellDay(i);
                    msg += ` ğŸ‰ åˆ›æ–°é«˜ï¼æ›´æ–°æœ€å¤§åˆ©æ¶¦ä¸º ${profit}ã€‚`;
                } else {
                    msg += ` (æœªè¶…è¿‡ ${maxProfit})`;
                }
            }

            setMessage(msg);
            setCurrDay(i + 1);
        };

        // --- æ¸²æŸ“æ ·å¼è¾…åŠ© ---
        const getCellClass = (index) => {
            let base = "w-12 flex flex-col items-center justify-end relative transition-all duration-300 ";
            const val = prices[index];

            // ç¡®å®šè¾¹æ¡†å’ŒèƒŒæ™¯é¢œè‰²
            let boxClass = "w-10 h-10 flex items-center justify-center border-2 rounded text-sm font-bold bg-white z-10 shadow-sm ";
            let borderColor = "border-slate-200";
            let textColor = "text-slate-700";
            let bgColor = "bg-white";

            if (mode === 'brute') {
                if (index === bruteBuy) { borderColor = "border-blue-500"; bgColor="bg-blue-50"; }
                if (index === bruteSell) { borderColor = "border-orange-500"; bgColor="bg-orange-50"; }
                if (index === bestBuyDay || index === bestSellDay) { bgColor = "bg-green-100"; borderColor = "border-green-500"; textColor = "text-green-700"; }
            } else {
                // One Pass
                if (index === currDay) { borderColor = "border-blue-500"; }
                if (index === minPriceIdx) { borderColor = "border-red-500"; bgColor="bg-red-50"; } // å†å²æœ€ä½ç‚¹
                if (index === bestBuyDay || index === bestSellDay) { bgColor = "bg-green-100"; borderColor = "border-green-500"; textColor = "text-green-700"; }

                // å¼ºè°ƒå½“å‰æ¯”è¾ƒ
                if (index === currDay) bgColor = "bg-blue-50";
            }

            boxClass += `${borderColor} ${textColor} ${bgColor}`;
            return { container: base, box: boxClass };
        };

        // è®¡ç®—æœ€å¤§å€¼ç”¨äºé«˜åº¦å½’ä¸€åŒ–
        const maxVal = Math.max(...prices, 1);

        return (
            <div className="max-w-4xl mx-auto p-6">
                {/* 1. é¡¶éƒ¨ï¼šè¾“å…¥é…ç½®åŒº */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
                    <div className="flex items-center gap-2 mb-3 text-slate-700 font-bold">
                        <Icons.Settings />
                        <span>æ•°æ®é…ç½®</span>
                    </div>
                    <div className="flex flex-col sm:flex-row gap-3">
                        <div className="flex-1">
                            <label className="text-xs text-slate-400 font-bold ml-1 mb-1 block">æ¯æ—¥è‚¡ä»·</label>
                            <input
                                type="text"
                                value={inputStr}
                                onChange={(e) => setInputStr(e.target.value)}
                                className="w-full border border-slate-300 rounded-lg px-3 py-2 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="7, 1, 5, 3, 6, 4"
                            />
                        </div>
                        <div className="flex items-end gap-2">
                            <button onClick={parseInput} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium text-sm h-[42px]">
                                åº”ç”¨
                            </button>
                            <button onClick={randomInput} className="px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition h-[42px]" title="éšæœºç”Ÿæˆ">
                                <Icons.Shuffle />
                            </button>
                        </div>
                    </div>
                </div>

                {/* 2. ç®—æ³•æ§åˆ¶åŒº */}
                <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    {/* Header */}
                    <div className="border-b border-slate-100 bg-slate-50 p-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div>
                            <h1 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <Icons.TrendingUp /> ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº
                            </h1>
                            <p className="text-xs text-slate-500 mt-1">é€‰æ‹©ä¸€å¤©ä¹°å…¥ï¼Œé€‰æ‹©æœªæ¥æŸå¤©å–å‡ºï¼Œæœ€å¤§åŒ–åˆ©æ¶¦ã€‚</p>
                        </div>
                        <div className="flex bg-slate-200 p-1 rounded-lg">
                            <button
                                onClick={() => { setMode('brute'); resetState(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium ${mode === 'brute' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                æš´åŠ›æšä¸¾ O(NÂ²)
                            </button>
                            <button
                                onClick={() => { setMode('onepass'); resetState(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium ${mode === 'onepass' ? 'bg-white text-green-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                ä¸€æ¬¡éå† O(N)
                            </button>
                        </div>
                    </div>

                    {/* Visualization Canvas */}
                    <div className="p-8 bg-slate-50 min-h-[300px] flex flex-col items-center justify-center">

                        {/* çŠ¶æ€çœ‹æ¿ (One Pass ä¸“ç”¨) */}
                        {mode === 'onepass' && (
                            <div className="flex gap-6 mb-8 w-full max-w-lg justify-center">
                                <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200 flex flex-col items-center min-w-[100px]">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Min Price</span>
                                    <span className={`text-xl font-bold ${minPrice === Infinity ? 'text-slate-300' : 'text-red-500'}`}>
                                            {minPrice === Infinity ? '-' : minPrice}
                                        </span>
                                </div>
                                <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200 flex flex-col items-center min-w-[100px]">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Max Profit</span>
                                    <span className="text-xl font-bold text-green-600">{maxProfit}</span>
                                </div>
                            </div>
                        )}

                        {/* Brute Force çœ‹æ¿ */}
                        {mode === 'brute' && (
                            <div className="flex gap-6 mb-8 w-full max-w-lg justify-center">
                                <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200 flex flex-col items-center min-w-[100px]">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Current Profit</span>
                                    <span className="text-xl font-bold text-slate-600">
                                            {(bruteBuy < prices.length && bruteSell < prices.length) ? prices[bruteSell] - prices[bruteBuy] : '-'}
                                        </span>
                                </div>
                                <div className="bg-white px-4 py-2 rounded-lg shadow-sm border border-slate-200 flex flex-col items-center min-w-[100px]">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Max Profit</span>
                                    <span className="text-xl font-bold text-green-600">{maxProfit}</span>
                                </div>
                            </div>
                        )}

                        {/* Array with Height Bars */}
                        <div className="flex items-end gap-2 h-40 pb-2">
                            {prices.map((price, index) => {
                                const { container, box } = getCellClass(index);
                                // Calculate height percentage (min 20%, max 100%)
                                const hPercent = Math.max(20, (price / maxVal) * 100);

                                return (
                                    <div key={index} className={container}>
                                        {/* Bar Visual */}
                                        <div
                                            className="w-8 bg-slate-200 rounded-t mb-1 transition-all duration-300 relative group"
                                            style={{ height: `${hPercent}px` }}
                                        >
                                            {/* Hover Tooltip */}
                                            <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-1 px-2 py-1 bg-black text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                                {price}
                                            </div>

                                            {/* Bar Highlighting */}
                                            {(mode === 'onepass' && index === minPriceIdx) && <div className="absolute inset-0 bg-red-400 opacity-50 rounded-t animate-pulse"></div>}
                                            {(mode === 'onepass' && index === currDay) && <div className="absolute inset-0 bg-blue-400 opacity-50 rounded-t"></div>}
                                            {(mode === 'brute' && index === bruteBuy) && <div className="absolute inset-0 bg-blue-400 opacity-50 rounded-t"></div>}
                                            {(mode === 'brute' && index === bruteSell) && <div className="absolute inset-0 bg-orange-400 opacity-50 rounded-t"></div>}

                                            {/* Best Result Highlight */}
                                            {isFinished && (index === bestBuyDay || index === bestSellDay) && (
                                                <div className="absolute inset-0 bg-green-500 opacity-60 rounded-t"></div>
                                            )}
                                        </div>

                                        {/* Number Box */}
                                        <div className={box}>
                                            {price}
                                            {/* Labels */}
                                            {mode === 'brute' && index === bruteBuy && <div className="absolute -bottom-6 text-[10px] font-bold text-blue-500">Buy</div>}
                                            {mode === 'brute' && index === bruteSell && <div className="absolute -bottom-6 text-[10px] font-bold text-orange-500">Sell</div>}
                                            {mode === 'onepass' && index === currDay && !isFinished && <div className="absolute -bottom-6 text-[10px] font-bold text-blue-500">Curr</div>}
                                            {mode === 'onepass' && index === minPriceIdx && <div className="absolute -bottom-6 text-[10px] font-bold text-red-500">Min</div>}
                                        </div>

                                        {/* Index */}
                                        <div className="absolute -bottom-10 text-[10px] text-slate-300 font-mono">{index + 1}æ—¥</div>
                                    </div>
                                );
                            })}
                        </div>

                    </div>

                    {/* Controls & Explanation */}
                    <div className="border-t border-slate-100 p-4 bg-white">
                        <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                            {/* Message */}
                            <div className="flex-1 bg-blue-50 text-blue-800 px-4 py-3 rounded-lg text-sm border-l-4 border-blue-500 w-full sm:w-auto whitespace-pre-line">
                                {message}
                            </div>

                            {/* Buttons */}
                            <div className="flex items-center gap-2">
                                <button onClick={() => setIsPlaying(!isPlaying)} disabled={isFinished} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-white font-medium transition ${isPlaying ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-600 hover:bg-blue-700'} disabled:opacity-50`}>
                                    {isPlaying ? <Icons.Pause /> : <Icons.Play />}
                                    <span className="hidden sm:inline">{isPlaying ? "æš‚åœ" : "è‡ªåŠ¨"}</span>
                                </button>
                                <button onClick={stepForward} disabled={isPlaying || isFinished} className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition disabled:opacity-50">
                                    <Icons.Step />
                                    <span className="hidden sm:inline">å•æ­¥</span>
                                </button>
                                <button onClick={() => resetState()} className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition">
                                    <Icons.Reset />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>