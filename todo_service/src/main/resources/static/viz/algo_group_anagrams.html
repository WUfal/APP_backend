<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>字母异位词分组 - 算法可视化</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .bucket-enter { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .item-enter { animation: slideDown 0.4s ease-out forwards; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .processing-box { transition: all 0.3s; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- 图标组件 ---
    const Icons = {
        Play: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
        Pause: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>,
        Step: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
        Reset: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /></svg>,
        Settings: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
        Shuffle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>,
        Key: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>,
        Sort: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 5h10"></path><path d="M11 9h7"></path><path d="M11 13h4"></path><path d="M3 17l3 3 3-3"></path><path d="M6 18V4"></path></svg>,
        Hash: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line></svg>
    };

    const App = () => {
        // --- 状态定义 ---
        const [inputStr, setInputStr] = useState('["eat", "tea", "tan", "ate", "nat", "bat"]');
        const [strs, setStrs] = useState(["eat", "tea", "tan", "ate", "nat", "bat"]);
        const [mode, setMode] = useState("sort"); // 'sort' | 'count'

        // 运行状态
        const [isPlaying, setIsPlaying] = useState(false);
        const [isFinished, setIsFinished] = useState(false);
        const [message, setMessage] = useState("准备就绪");

        // 算法状态
        const [currentIndex, setCurrentIndex] = useState(0);
        const [groups, setGroups] = useState({}); // { key: [str1, str2...] }
        const [currentKey, setCurrentKey] = useState(null); // 当前计算出的 key
        const [stepPhase, setStepPhase] = useState("PICK"); // PICK, TRANSFORM, GROUP

        // --- 初始化/重置 ---
        const parseInput = () => {
            try {
                // Try to be lenient with input format
                let arr;
                if (inputStr.trim().startsWith('[')) {
                    arr = JSON.parse(inputStr);
                } else {
                    arr = inputStr.split(/[,，\s]+/).filter(s => s).map(s => s.replace(/['"]/g, ''));
                }
                if (!Array.isArray(arr)) throw new Error("输入必须是数组");

                setStrs(arr);
                resetState(arr);
                setMessage(`已加载 ${arr.length} 个字符串。`);
            } catch (e) {
                setMessage("输入格式错误，请使用 JSON 数组格式。");
            }
        };

        const resetState = (arr = strs) => {
            setIsPlaying(false);
            setIsFinished(false);
            setMessage("状态已重置");
            setCurrentIndex(0);
            setGroups({});
            setCurrentKey(null);
            setStepPhase("PICK");
        };

        const randomInput = () => {
            const words = ["abc", "bca", "cab", "cat", "act", "dog", "god", "odg", "car", "arc"];
            // Pick 6 random words
            const arr = [];
            for(let i=0; i<6; i++) {
                arr.push(words[Math.floor(Math.random() * words.length)]);
            }
            setInputStr(JSON.stringify(arr));
            setStrs(arr);
            resetState(arr);
            setMessage("已生成随机异位词组。");
        };

        // --- 自动播放 ---
        useEffect(() => {
            let timer;
            if (isPlaying && !isFinished) {
                timer = setInterval(() => {
                    stepForward();
                }, 1200);
            }
            return () => clearInterval(timer);
        }, [isPlaying, isFinished, mode, currentIndex, groups, stepPhase]);

        const stepForward = () => {
            if (isFinished) return;

            if (stepPhase === "PICK") {
                if (currentIndex >= strs.length) {
                    setIsFinished(true);
                    setIsPlaying(false);
                    setMessage("所有字符串处理完毕！");
                    setStepPhase("FINISHED");
                    return;
                }
                setMessage(`选中字符串: "${strs[currentIndex]}"`);
                setStepPhase("TRANSFORM");
            }
            else if (stepPhase === "TRANSFORM") {
                const str = strs[currentIndex];
                let key = "";
                if (mode === "sort") {
                    key = str.split('').sort().join('');
                    setMessage(`[排序法] 字符串 "${str}" 排序后得到 Key: "${key}"`);
                } else {
                    // Count method
                    const count = new Array(26).fill(0);
                    for (let char of str) {
                        count[char.charCodeAt(0) - 97]++;
                    }
                    // Create a visual string for key representation
                    // e.g. a1c1t1... simplified for UI
                    // Using a standard hash key like #1#0#2... is optimal but ugly for visualization
                    // Let's show filtered counts for UI clarity
                    key = count.map((c, i) => c > 0 ? String.fromCharCode(97+i) + c : '').join('');
                    setMessage(`[计数法] 统计 "${str}" 字符频次得到 Key: "${key}"`);
                }
                setCurrentKey(key);
                setStepPhase("GROUP");
            }
            else if (stepPhase === "GROUP") {
                const str = strs[currentIndex];
                const key = currentKey;

                const newGroups = { ...groups };
                if (!newGroups[key]) newGroups[key] = [];
                newGroups[key].push(str);

                setGroups(newGroups);
                setMessage(`将 "${str}" 放入 Key 为 "${key}" 的分组中。`);

                setCurrentIndex(currentIndex + 1);
                setCurrentKey(null);
                setStepPhase("PICK");
            }
        };

        return (
            <div className="max-w-4xl mx-auto p-6">
                {/* 1. 配置区 */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
                    <div className="flex items-center gap-2 mb-3 text-slate-700 font-bold">
                        <Icons.Settings />
                        <span>数据配置</span>
                    </div>
                    <div className="flex flex-col sm:flex-row gap-3">
                        <input
                            type="text"
                            value={inputStr}
                            onChange={(e) => setInputStr(e.target.value)}
                            className="flex-1 border border-slate-300 rounded-lg px-3 py-2 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder='["eat", "tea", "tan", "ate", "nat", "bat"]'
                        />
                        <div className="flex gap-2">
                            <button onClick={parseInput} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium text-sm whitespace-nowrap">
                                加载
                            </button>
                            <button onClick={randomInput} className="px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition" title="随机生成">
                                <Icons.Shuffle />
                            </button>
                        </div>
                    </div>
                </div>

                {/* 2. 主区域 */}
                <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    {/* Header */}
                    <div className="border-b border-slate-100 bg-slate-50 p-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div>
                            <h1 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <Icons.Key /> 字母异位词分组
                            </h1>
                            <p className="text-xs text-slate-500 mt-1">将字符组成相同的字符串归为一组。</p>
                        </div>
                        <div className="flex bg-slate-200 p-1 rounded-lg">
                            <button
                                onClick={() => { setMode('sort'); resetState(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium flex items-center gap-1 ${mode === 'sort' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                <Icons.Sort /> 排序法 O(NKlogK)
                            </button>
                            <button
                                onClick={() => { setMode('count'); resetState(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium flex items-center gap-1 ${mode === 'count' ? 'bg-white text-purple-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                <Icons.Hash /> 计数法 O(NK)
                            </button>
                        </div>
                    </div>

                    {/* Visualization Canvas */}
                    <div className="p-8 bg-slate-50 min-h-[400px] flex flex-col gap-8">

                        {/* Top: Input Array */}
                        <div className="flex flex-col items-center">
                            <div className="text-xs font-bold text-slate-400 mb-2 tracking-widest">INPUT ARRAY</div>
                            <div className="flex flex-wrap justify-center gap-2">
                                {strs.map((str, idx) => (
                                    <div
                                        key={idx}
                                        className={`px-4 py-2 rounded-lg font-mono border-2 transition-all duration-300
                                                ${idx === currentIndex && stepPhase !== 'FINISHED'
                                            ? 'bg-blue-500 border-blue-600 text-white shadow-lg scale-110'
                                            : idx < currentIndex
                                                ? 'bg-slate-200 border-slate-300 text-slate-400 opacity-60'
                                                : 'bg-white border-slate-200 text-slate-700'}
                                            `}
                                    >
                                        {str}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Middle: Processor (Animation Zone) */}
                        <div className="h-32 flex items-center justify-center">
                            {stepPhase !== "PICK" && stepPhase !== "FINISHED" && (
                                <div className="flex items-center gap-4 bg-white p-6 rounded-xl border border-slate-200 shadow-sm processing-box animate-in fade-in zoom-in">
                                    {/* Source */}
                                    <div className="flex flex-col items-center">
                                        <span className="text-xs text-slate-400 mb-1">String</span>
                                        <span className="text-2xl font-bold font-mono text-slate-800">{strs[currentIndex]}</span>
                                    </div>

                                    {/* Arrow & Method */}
                                    <div className="flex flex-col items-center px-4">
                                            <span className="text-[10px] bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full mb-1">
                                                {mode === 'sort' ? 'Sorting' : 'Counting'}
                                            </span>
                                        <svg className="w-8 h-8 text-slate-300 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                                    </div>

                                    {/* Target Key */}
                                    <div className="flex flex-col items-center">
                                        <span className="text-xs text-slate-400 mb-1">Hash Key</span>
                                        <div className={`px-3 py-1 rounded bg-orange-50 border border-orange-200 text-orange-600 font-mono font-bold ${currentKey ? 'opacity-100 scale-100' : 'opacity-0 scale-90'} transition-all duration-300`}>
                                            {currentKey || "..."}
                                        </div>
                                    </div>
                                </div>
                            )}
                            {stepPhase === "FINISHED" && (
                                <div className="text-green-600 font-bold text-xl flex items-center gap-2">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path></svg>
                                    Done!
                                </div>
                            )}
                        </div>

                        {/* Bottom: Hash Map Buckets */}
                        <div className="flex flex-col items-center w-full">
                            <div className="text-xs font-bold text-slate-400 mb-4 tracking-widest flex items-center gap-2">
                                <Icons.Key size={14}/> HASH MAP (BUCKETS)
                            </div>
                            <div className="flex flex-wrap justify-center gap-4 w-full">
                                {Object.entries(groups).map(([key, list], i) => (
                                    <div key={key} className="bg-white rounded-lg border border-slate-200 shadow-sm min-w-[140px] overflow-hidden bucket-enter flex flex-col">
                                        {/* Key Header */}
                                        <div className="bg-slate-50 px-3 py-2 border-b border-slate-100 flex justify-between items-center">
                                            <span className="text-xs font-mono font-bold text-slate-500 truncate max-w-[100px]" title={key}>{key}</span>
                                            <span className="bg-blue-100 text-blue-600 text-[10px] px-1.5 py-0.5 rounded-full">{list.length}</span>
                                        </div>
                                        {/* Value List */}
                                        <div className="p-2 flex flex-col gap-1">
                                            {list.map((s, idx) => (
                                                <div key={`${key}-${idx}`} className="text-center text-sm bg-blue-50 text-blue-700 py-1 rounded item-enter">
                                                    {s}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                                {Object.keys(groups).length === 0 && (
                                    <div className="text-slate-300 italic text-sm py-8">
                                        暂无分组...
                                    </div>
                                )}
                            </div>
                        </div>

                    </div>

                    {/* Controls */}
                    <div className="border-t border-slate-100 p-4 bg-white">
                        <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                            <div className="flex-1 bg-blue-50 text-blue-800 px-4 py-3 rounded-lg text-sm border-l-4 border-blue-500 w-full sm:w-auto whitespace-pre-line shadow-sm">
                                {message}
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => setIsPlaying(!isPlaying)} disabled={isFinished} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-white font-medium transition ${isPlaying ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-600 hover:bg-blue-700'} disabled:opacity-50`}>
                                    {isPlaying ? <Icons.Pause /> : <Icons.Play />}
                                    <span className="hidden sm:inline">{isPlaying ? "暂停" : "自动"}</span>
                                </button>
                                <button onClick={stepForward} disabled={isPlaying || isFinished} className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition disabled:opacity-50">
                                    <Icons.Step />
                                    <span className="hidden sm:inline">单步</span>
                                </button>
                                <button onClick={() => resetState()} className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition">
                                    <Icons.Reset />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>