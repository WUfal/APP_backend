<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å¤§å­æ•°ç»„å’Œ - ç®—æ³•å¯è§†åŒ–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .cell-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0.5; } 50% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- å›¾æ ‡ç»„ä»¶ ---
    const Icons = {
        Play: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
        Pause: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>,
        Step: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
        Reset: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /></svg>,
        Settings: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
        Shuffle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
    };

    // --- è¾…åŠ©å‡½æ•° ---
    const parseInput = (str) => {
        return str.split(/[,ï¼Œ\s]+/)
            .map(v => parseInt(v.trim()))
            .filter(v => !isNaN(v));
    };

    const App = () => {
        // --- çŠ¶æ€å®šä¹‰ ---
        const [inputStr, setInputStr] = useState("-2, 1, -3, 4, -1, 2, 1, -5, 4");
        const [nums, setNums] = useState([-2, 1, -3, 4, -1, 2, 1, -5, 4]);
        const [mode, setMode] = useState("kadane"); // 'brute' | 'kadane'

        // è¿è¡ŒçŠ¶æ€
        const [isPlaying, setIsPlaying] = useState(false);
        const [isFinished, setIsFinished] = useState(false);
        const [message, setMessage] = useState("å‡†å¤‡å°±ç»ª");

        // é€šç”¨ç®—æ³•å˜é‡
        const [maxSum, setMaxSum] = useState(-Infinity);
        const [maxRange, setMaxRange] = useState({ start: -1, end: -1 }); // å…¨å±€æœ€ä¼˜è§£èŒƒå›´

        // æš´åŠ›æ³•çŠ¶æ€ (O(N^2))
        const [bruteI, setBruteI] = useState(0); // èµ·ç‚¹
        const [bruteJ, setBruteJ] = useState(0); // ç»ˆç‚¹
        const [currentSubSum, setCurrentSubSum] = useState(0); // å½“å‰å­æ•°ç»„å’Œ

        // Kadane çŠ¶æ€ (O(N))
        const [kadaneI, setKadaneI] = useState(0); // å½“å‰éå†ä½ç½®
        const [currentSum, setCurrentSum] = useState(0); // åŒ…å«å½“å‰å…ƒç´ çš„æœ€å¤§å­æ•°ç»„å’Œ
        const [currentStart, setCurrentStart] = useState(0); // å½“å‰çª—å£èµ·ç‚¹

        // --- è¾…åŠ©å‡½æ•° ---
        const reset = (newNums = nums) => {
            setIsPlaying(false);
            setIsFinished(false);
            setMaxSum(-Infinity);
            setMaxRange({ start: -1, end: -1 });
            setMessage("çŠ¶æ€å·²é‡ç½®");

            // Brute Reset
            setBruteI(0);
            setBruteJ(0);
            setCurrentSubSum(0);

            // Kadane Reset
            setKadaneI(0);
            setCurrentSum(0); // ä¸ºäº†æ¼”ç¤ºï¼Œåˆå§‹è®¾ä¸º0ï¼Œç¬¬ä¸€æ­¥ä¼šå¤„ç†
            setCurrentStart(0);
        };

        const loadInput = () => {
            const arr = parseInput(inputStr);
            if (arr.length === 0) return;
            setNums(arr);
            reset(arr);
            setMessage(`å·²åŠ è½½æ•°æ®ï¼Œé•¿åº¦: ${arr.length}`);
        };

        const randomInput = () => {
            const len = 8 + Math.floor(Math.random() * 5);
            const arr = [];
            for(let i=0; i<len; i++) {
                // ç”Ÿæˆ -9 åˆ° 9 çš„éšæœºæ•°
                arr.push(Math.floor(Math.random() * 19) - 9);
            }
            const str = arr.join(", ");
            setInputStr(str);
            setNums(arr);
            reset(arr);
            setMessage("å·²ç”Ÿæˆéšæœºæ•°ç»„");
        };

        // --- è‡ªåŠ¨æ’­æ”¾é€»è¾‘ ---
        useEffect(() => {
            let timer;
            if (isPlaying && !isFinished) {
                timer = setInterval(() => {
                    stepForward();
                }, 1000); // 1ç§’ä¸€æ­¥
            }
            return () => clearInterval(timer);
        }, [isPlaying, isFinished, mode, bruteI, bruteJ, kadaneI, nums]);

        // --- æ ¸å¿ƒç®—æ³•æ­¥éª¤ ---
        const stepForward = () => {
            if (isFinished) return;

            if (mode === 'brute') {
                stepBrute();
            } else {
                stepKadane();
            }
        };

        // 1. æš´åŠ›æ³• (åŒå±‚å¾ªç¯)
        const stepBrute = () => {
            if (bruteI >= nums.length) {
                setIsFinished(true);
                setIsPlaying(false);
                setMessage(`éå†ç»“æŸã€‚æœ€å¤§å­æ•°ç»„å’Œ: ${maxSum}`);
                return;
            }

            // è®¡ç®— nums[bruteI...bruteJ] çš„å’Œ
            // ä¼˜åŒ–ï¼šåˆ©ç”¨ä¸Šä¸€æ­¥çš„å’Œ
            let sum;
            if (bruteJ === bruteI) {
                sum = nums[bruteI];
            } else {
                sum = currentSubSum + nums[bruteJ];
            }
            setCurrentSubSum(sum);

            let msg = `å­æ•°ç»„ [${bruteI}, ${bruteJ}] å’Œä¸º ${sum}ã€‚`;

            // æ›´æ–°å…¨å±€æœ€å¤§
            if (sum > maxSum || maxSum === -Infinity) {
                setMaxSum(sum);
                setMaxRange({ start: bruteI, end: bruteJ });
                msg += ` ğŸ¯ å‘ç°æ–°æœ€å¤§å€¼ ${sum}ï¼`;
            }
            setMessage(msg);

            // ç§»åŠ¨æŒ‡é’ˆ
            let nextJ = bruteJ + 1;
            if (nextJ >= nums.length) {
                // J åˆ°å¤´ï¼ŒI è¿›ä½
                setBruteI(bruteI + 1);
                setBruteJ(bruteI + 1);
                setCurrentSubSum(0); // é‡ç½®ä¸´æ—¶å’Œ
            } else {
                setBruteJ(nextJ);
            }
        };

        // 2. Kadane ç®—æ³• (åŠ¨æ€è§„åˆ’)
        const stepKadane = () => {
            if (kadaneI >= nums.length) {
                setIsFinished(true);
                setIsPlaying(false);
                setMessage(`éå†ç»“æŸã€‚æœ€å¤§å­æ•°ç»„å’Œ: ${maxSum}`);
                return;
            }

            const x = nums[kadaneI];
            let nextCurrentSum;
            let nextStart = currentStart;
            let msg = "";

            // æ ¸å¿ƒé€»è¾‘ï¼šæ˜¯è¦â€œå»¶ç»­ä¹‹å‰çš„å­æ•°ç»„â€è¿˜æ˜¯â€œå¦èµ·ç‚‰ç¶â€
            // dp[i] = max(nums[i], dp[i-1] + nums[i])

            // åˆå§‹æƒ…å†µ
            if (kadaneI === 0) {
                nextCurrentSum = x;
                nextStart = 0;
                msg = `åˆå§‹å…ƒç´  ${x}ã€‚`;
            } else {
                if (currentSum + x > x) {
                    // å»¶ç»­
                    nextCurrentSum = currentSum + x;
                    msg = `å½“å‰å€¼ ${x}ï¼Œç´¯åŠ å (${currentSum + x}) > å•ç‹¬ (${x})ã€‚å»¶ç»­å­æ•°ç»„ã€‚`;
                } else {
                    // å¦èµ·ç‚‰ç¶ (è¯´æ˜ä¹‹å‰çš„å’Œæ˜¯è´Ÿçš„ï¼Œæ‹–ç´¯äº†å½“å‰)
                    nextCurrentSum = x;
                    nextStart = kadaneI;
                    msg = `ä¹‹å‰çš„å’Œ ${currentSum} ä¸ºè´Ÿï¼ŒæŠ›å¼ƒï¼ä» ${x} é‡æ–°å¼€å§‹ã€‚`;
                }
            }

            setCurrentSum(nextCurrentSum);
            setCurrentStart(nextStart);

            // æ›´æ–°å…¨å±€æœ€å¤§
            if (nextCurrentSum > maxSum || maxSum === -Infinity) {
                setMaxSum(nextCurrentSum);
                setMaxRange({ start: nextStart, end: kadaneI });
                msg += ` ğŸ¯ åˆ·æ–°æœ€å¤§å’Œ: ${nextCurrentSum}`;
            }

            setMessage(msg);
            setKadaneI(kadaneI + 1);
        };

        // --- æ¸²æŸ“é€»è¾‘ ---
        const getCellClass = (index) => {
            let base = "w-10 h-10 sm:w-12 sm:h-12 flex flex-col items-center justify-center border rounded-lg font-mono text-sm sm:text-lg font-bold relative cell-transition shadow-sm ";

            // åŸºç¡€èƒŒæ™¯
            base += "bg-white border-slate-200 text-slate-500 ";

            // å…¨å±€æœ€ä¼˜è§£é«˜äº® (ç»¿è‰²) - ä¼˜å…ˆçº§æœ€é«˜
            if (maxRange.start !== -1 && index >= maxRange.start && index <= maxRange.end) {
                base = base.replace("bg-white", "bg-green-50");
                base = base.replace("border-slate-200", "border-green-400");
                base = base.replace("text-slate-500", "text-green-700");
            }

            // å½“å‰æ­£åœ¨å¤„ç†çš„åŒºé—´é«˜äº®
            if (mode === 'brute') {
                if (index >= bruteI && index <= bruteJ) {
                    base = base.replace("bg-white", "bg-rose-50"); // è¦†ç›–ç™½è‰²
                    base = base.replace("bg-green-50", "bg-rose-50"); // ä¸´æ—¶è¦†ç›–ç»¿è‰²ï¼Œè¡¨ç¤ºæ­£åœ¨æ£€æŸ¥
                    base += " border-rose-400 text-rose-800 scale-105 z-10 ring-2 ring-rose-200 ";
                }
            } else {
                // Kadane
                // å½“å‰ç´¯åŠ åŒºé—´
                if (index >= currentStart && index < kadaneI) {
                    base += " bg-rose-50 border-rose-300 text-rose-800 ";
                }
                // å½“å‰æŒ‡é’ˆ
                if (index === kadaneI && !isFinished) {
                    base += " ring-4 ring-blue-200 border-blue-500 bg-white text-blue-700 scale-110 z-20 ";
                }
            }

            return base;
        };

        return (
            <div className="max-w-3xl mx-auto p-4 sm:p-6">
                {/* 1. é¡¶éƒ¨ï¼šè¾“å…¥é…ç½®åŒº */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
                    <div className="flex items-center gap-2 mb-3 text-slate-700 font-bold">
                        <Icons.Settings />
                        <span>æ•°æ®é…ç½®</span>
                    </div>
                    <div className="flex flex-col sm:flex-row gap-3">
                        <input
                            type="text"
                            value={inputStr}
                            onChange={(e) => setInputStr(e.target.value)}
                            className="flex-1 border border-slate-300 rounded-lg px-3 py-2 font-mono focus:outline-none focus:ring-2 focus:ring-rose-500 text-sm"
                            placeholder="è¾“å…¥æ•°å­—ï¼Œé€—å·åˆ†éš”..."
                        />
                        <div className="flex gap-2">
                            <button onClick={loadInput} className="px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition font-medium text-sm">
                                åŠ è½½
                            </button>
                            <button onClick={randomInput} className="px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition" title="éšæœºç”Ÿæˆ">
                                <Icons.Shuffle />
                            </button>
                        </div>
                    </div>
                </div>

                {/* 2. ç®—æ³•æ§åˆ¶åŒº */}
                <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    {/* Header */}
                    <div className="border-b border-slate-100 bg-slate-50 p-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div>
                            <h1 className="text-xl font-bold text-slate-800">æœ€å¤§å­æ•°ç»„å’Œ</h1>
                            <p className="text-xs text-slate-500 mt-1">å¯»æ‰¾å’Œæœ€å¤§çš„è¿ç»­å­æ•°ç»„ (LeetCode 53)</p>
                        </div>
                        <div className="flex bg-slate-200 p-1 rounded-lg">
                            <button
                                onClick={() => { setMode('brute'); reset(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium ${mode === 'brute' ? 'bg-white text-rose-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                æš´åŠ›æ³• O(NÂ²)
                            </button>
                            <button
                                onClick={() => { setMode('kadane'); reset(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium ${mode === 'kadane' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                Kadane ç®—æ³• O(N)
                            </button>
                        </div>
                    </div>

                    {/* Canvas */}
                    <div className="p-8 flex flex-col items-center justify-center bg-slate-50 min-h-[260px]">

                        {/* Info Panel */}
                        <div className="flex justify-center gap-8 mb-8 w-full">
                            <div className="flex flex-col items-center">
                                <span className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Current Sum</span>
                                <span className={`text-2xl font-mono font-bold ${mode === 'brute' ? (currentSubSum < 0 ? 'text-red-500' : 'text-slate-700') : (currentSum < 0 ? 'text-red-500' : 'text-slate-700')}`}>
                                    {mode === 'brute' ? currentSubSum : currentSum}
                                </span>
                            </div>
                            <div className="w-px bg-slate-200 h-10"></div>
                            <div className="flex flex-col items-center">
                                <span className="text-xs font-bold text-green-600 uppercase tracking-wider mb-1">Max Found</span>
                                <span className="text-3xl font-black text-green-600">
                                    {maxSum === -Infinity ? '--' : maxSum}
                                </span>
                            </div>
                        </div>

                        {/* Array Visualization */}
                        <div className="flex flex-wrap justify-center gap-2 sm:gap-3 mb-6">
                            {nums.map((num, idx) => (
                                <div key={idx} className="flex flex-col items-center group">
                                    {/* æŒ‡é’ˆæŒ‡ç¤ºå™¨ (é¡¶éƒ¨) */}
                                    <div className="h-6 mb-1 relative w-full flex justify-center text-[10px] font-bold">
                                        {mode === 'brute' && idx === bruteI && <span className="text-slate-400 absolute bottom-0">i</span>}
                                        {mode === 'brute' && idx === bruteJ && <span className="text-rose-500 absolute bottom-0">j</span>}

                                        {mode === 'kadane' && idx === currentStart && !isFinished && <span className="text-slate-400 absolute bottom-0">Start</span>}
                                        {mode === 'kadane' && idx === kadaneI && !isFinished && <span className="text-blue-600 absolute -top-1 animate-bounce">i</span>}
                                    </div>

                                    {/* å•å…ƒæ ¼ */}
                                    <div className={getCellClass(idx)}>
                                        <span className={num < 0 ? "text-red-500" : ""}>{num}</span>
                                        {/* ç´¢å¼• (åº•éƒ¨) */}
                                        <span className="absolute -bottom-5 text-[10px] text-slate-300 font-normal">
                                            {idx}
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="border-t border-slate-100 p-4 bg-white">
                        <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                            {/* Message */}
                            <div className="flex-1 bg-rose-50 text-rose-900 px-4 py-3 rounded-lg text-sm border-l-4 border-rose-500 w-full sm:w-auto transition-colors">
                                {message}
                            </div>

                            {/* Buttons */}
                            <div className="flex items-center gap-2">
                                <button onClick={() => setIsPlaying(!isPlaying)} disabled={isFinished} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-white font-medium transition ${isPlaying ? 'bg-slate-500 hover:bg-slate-600' : 'bg-rose-600 hover:bg-rose-700'} disabled:opacity-50 disabled:bg-slate-300`}>
                                    {isPlaying ? <Icons.Pause /> : <Icons.Play />}
                                    <span className="hidden sm:inline">{isPlaying ? "æš‚åœ" : "è‡ªåŠ¨"}</span>
                                </button>
                                <button onClick={stepForward} disabled={isPlaying || isFinished} className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition disabled:opacity-50">
                                    <Icons.Step />
                                    <span className="hidden sm:inline">å•æ­¥</span>
                                </button>
                                <button onClick={() => reset()} className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition" title="é‡ç½®">
                                    <Icons.Reset />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>