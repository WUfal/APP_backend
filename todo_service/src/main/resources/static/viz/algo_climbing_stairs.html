<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ¬æ¥¼æ¢¯ - ç®—æ³•å¯è§†åŒ–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .stair-transition { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- å›¾æ ‡ç»„ä»¶ ---
    const Icons = {
        Play: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
        Pause: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>,
        Step: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
        Reset: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /></svg>,
        Settings: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
        Shuffle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>,
        TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>,
        Layers: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
    };

    const App = () => {
        // --- çŠ¶æ€å®šä¹‰ ---
        const [nInput, setNInput] = useState(5);
        const [n, setN] = useState(5);
        const [mode, setMode] = useState("dp"); // 'dp' | 'optimized'

        // è¿è¡ŒçŠ¶æ€
        const [isPlaying, setIsPlaying] = useState(false);
        const [isFinished, setIsFinished] = useState(false);
        const [message, setMessage] = useState("å‡†å¤‡å°±ç»ª");

        // ç®—æ³•çŠ¶æ€
        const [dp, setDp] = useState([]); // Array to store ways for each step
        const [currentStep, setCurrentStep] = useState(0); // å½“å‰è®¡ç®—çš„å°é˜¶ (index)

        // æ»šåŠ¨æ•°ç»„ä¸“ç”¨çŠ¶æ€
        const [prev1, setPrev1] = useState(0); // f(i-1)
        const [prev2, setPrev2] = useState(0); // f(i-2)
        const [currVal, setCurrVal] = useState(0); // f(i)

        // --- åˆå§‹åŒ–/é‡ç½® ---
        const init = (val = nInput) => {
            let num = parseInt(val);
            if (isNaN(num) || num < 1) num = 1;
            if (num > 15) num = 15; // Limit for UI

            setN(num);
            setNInput(num);

            resetState(num);
        };

        const resetState = (num = n) => {
            setIsPlaying(false);
            setIsFinished(false);
            setMessage("çŠ¶æ€å·²é‡ç½®");

            // Initialize DP array with 0s
            // dp[0] is ground (0 ways or 1 way depending on definition, let's say index 1 is step 1)
            // We will use 1-based indexing logic mapped to 0-based array
            // Index 0 = Step 1, Index 1 = Step 2...
            const newDp = Array(num).fill(0);
            setDp(newDp);
            setCurrentStep(-1); // Not started

            // Rolling Vars
            setPrev1(0);
            setPrev2(0);
            setCurrVal(0);
        };

        const randomInput = () => {
            const rand = 4 + Math.floor(Math.random() * 8); // 4-11 steps
            init(rand);
            setMessage(`å·²éšæœºç”Ÿæˆæ¥¼æ¢¯å±‚æ•°: ${rand}`);
        };

        // --- è‡ªåŠ¨æ’­æ”¾ ---
        useEffect(() => {
            let timer;
            if (isPlaying && !isFinished) {
                timer = setInterval(() => {
                    stepForward();
                }, 1000);
            }
            return () => clearInterval(timer);
        }, [isPlaying, isFinished, mode, currentStep, dp, n, prev1, prev2]);

        const stepForward = () => {
            if (isFinished) return;

            if (mode === 'dp') {
                stepDP();
            } else {
                stepOptimized();
            }
        };

        // 1. åŠ¨æ€è§„åˆ’ (DP Table)
        const stepDP = () => {
            const i = currentStep + 1; // i is the step index we are about to calculate (0-based: 0=Step1)

            if (i >= n) {
                setIsFinished(true);
                setIsPlaying(false);
                setMessage(`è®¡ç®—å®Œæˆï¼åˆ°è¾¾ç¬¬ ${n} é˜¶çš„æ–¹æ³•æ€»æ•°ä¸º: ${dp[n-1]}`);
                return;
            }

            const newDp = [...dp];
            let ways = 0;
            let msg = "";

            if (i === 0) {
                // Step 1
                ways = 1;
                msg = `ç¬¬ 1 é˜¶ï¼šåªæœ‰ 1 ç§æ–¹æ³• (è¿ˆ 1 æ­¥)ã€‚f(1) = 1`;
            } else if (i === 1) {
                // Step 2
                ways = 2;
                msg = `ç¬¬ 2 é˜¶ï¼šæœ‰ä¸¤ç§æ–¹æ³• (1+1 æˆ– 2)ã€‚f(2) = 2`;
            } else {
                // Step > 2
                // f(i) = f(i-1) + f(i-2)
                // In array: dp[i] = dp[i-1] + dp[i-2]
                const val1 = dp[i-1];
                const val2 = dp[i-2];
                ways = val1 + val2;
                msg = `ç¬¬ ${i+1} é˜¶ï¼šä»ç¬¬ ${i} é˜¶è·¨1æ­¥ (${val1}) + ä»ç¬¬ ${i-1} é˜¶è·¨2æ­¥ (${val2}) = ${ways}`;
            }

            newDp[i] = ways;
            setDp(newDp);
            setCurrentStep(i);
            setMessage(msg);
        };

        // 2. æ»šåŠ¨æ•°ç»„ (Optimized Space)
        const stepOptimized = () => {
            const i = currentStep + 1; // 0-based index

            if (i >= n) {
                setIsFinished(true);
                setIsPlaying(false);
                setMessage(`è®¡ç®—å®Œæˆï¼åˆ°è¾¾ç¬¬ ${n} é˜¶çš„æ–¹æ³•æ€»æ•°ä¸º: ${currVal}`);
                return;
            }

            let ways = 0;
            let msg = "";

            // Logic mapping:
            // p2 = f(i-2), p1 = f(i-1), curr = f(i)

            if (i === 0) {
                ways = 1;
                setPrev1(1); // f(1)
                setPrev2(0); // f(0) dummy
                setCurrVal(1);
                msg = `ç¬¬ 1 é˜¶ï¼šåˆå§‹åŒ– f(1) = 1ã€‚`;
            } else if (i === 1) {
                ways = 2;
                setPrev2(1); // f(1) becomes p2
                setPrev1(2); // f(2) becomes p1
                setCurrVal(2);
                msg = `ç¬¬ 2 é˜¶ï¼šåˆå§‹åŒ– f(2) = 2ã€‚`;
            } else {
                ways = prev1 + prev2;
                setPrev2(prev1);
                setPrev1(ways);
                setCurrVal(ways);
                msg = `ç¬¬ ${i+1} é˜¶ï¼šè®¡ç®— f(${i+1}) = f(${i}) + f(${i-1}) = ${prev1} + ${prev2} = ${ways}ã€‚æ»šåŠ¨æ›´æ–°å˜é‡ã€‚`;
            }

            // Also update visual array for clarity, even though algo uses O(1)
            const newDp = [...dp];
            newDp[i] = ways;
            setDp(newDp);

            setCurrentStep(i);
            setMessage(msg);
        };

        // --- æ¸²æŸ“è¾…åŠ© ---
        const getStepStyle = (index) => {
            let base = "relative border-t-4 border-r-4 border-slate-300 bg-slate-100 flex items-center justify-center transition-all duration-500 ";
            // Height grows with index to form stairs
            // We'll handle layout via flex/grid, here we style the box

            if (index === currentStep) {
                if (mode === 'dp') return base + "bg-blue-100 border-blue-500 shadow-lg scale-105 z-10";
                if (mode === 'optimized') return base + "bg-green-100 border-green-500 shadow-lg scale-105 z-10";
            }

            // Highlight previous two steps
            if (!isFinished && currentStep >= 2) {
                if (index === currentStep - 1) return base + "bg-yellow-50 border-yellow-400";
                if (index === currentStep - 2) return base + "bg-orange-50 border-orange-400";
            }

            if (dp[index] > 0) return base + "bg-white border-slate-400";

            return base;
        };

        return (
            <div className="max-w-4xl mx-auto p-6">
                {/* 1. é…ç½®åŒº */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
                    <div className="flex items-center gap-2 mb-3 text-slate-700 font-bold">
                        <Icons.Settings />
                        <span>æ•°æ®é…ç½®</span>
                    </div>
                    <div className="flex flex-col sm:flex-row gap-3 items-end">
                        <div className="flex-1">
                            <label className="text-xs text-slate-400 font-bold ml-1 mb-1 block">å°é˜¶æ•°é‡ (N)</label>
                            <input
                                type="number"
                                min="1" max="15"
                                value={nInput}
                                onChange={(e) => setNInput(e.target.value)}
                                className="w-full border border-slate-300 rounded-lg px-3 py-2 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => init(nInput)} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium text-sm h-[42px]">
                                ç”Ÿæˆæ¥¼æ¢¯
                            </button>
                            <button onClick={randomInput} className="px-3 py-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-200 transition h-[42px]" title="éšæœº">
                                <Icons.Shuffle />
                            </button>
                        </div>
                    </div>
                </div>

                {/* 2. ä¸»åŒºåŸŸ */}
                <div className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    {/* Header */}
                    <div className="border-b border-slate-100 bg-slate-50 p-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div>
                            <h1 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <Icons.TrendingUp /> çˆ¬æ¥¼æ¢¯ (Climbing Stairs)
                            </h1>
                            <p className="text-xs text-slate-500 mt-1">æ¯æ¬¡çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ï¼Œæœ‰å¤šå°‘ç§æ–¹æ³•åˆ°è¾¾æ¥¼é¡¶ï¼Ÿ</p>
                        </div>
                        <div className="flex bg-slate-200 p-1 rounded-lg">
                            <button
                                onClick={() => { setMode('dp'); resetState(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium ${mode === 'dp' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                DP æ•°ç»„ O(N)
                            </button>
                            <button
                                onClick={() => { setMode('optimized'); resetState(); }}
                                className={`px-3 py-1.5 text-sm rounded-md transition-all font-medium ${mode === 'optimized' ? 'bg-white text-green-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                æ»šåŠ¨æ•°ç»„ O(1)
                            </button>
                        </div>
                    </div>

                    {/* Visualization Area */}
                    <div className="p-8 bg-slate-50 min-h-[400px] flex flex-col items-center justify-center relative">

                        {/* çŠ¶æ€çœ‹æ¿ (æ»šåŠ¨æ•°ç»„ä¸“ç”¨) */}
                        {mode === 'optimized' && (
                            <div className="absolute top-4 right-4 bg-white/90 p-3 rounded-lg border border-slate-200 shadow-sm text-sm space-y-1 z-20 backdrop-blur-sm">
                                <div className="font-bold text-slate-600 border-b pb-1 mb-1">æ»šåŠ¨å˜é‡</div>
                                <div className="flex justify-between gap-4"><span className="text-orange-500 font-mono">p2 (i-2):</span> <span className="font-bold">{prev2}</span></div>
                                <div className="flex justify-between gap-4"><span className="text-yellow-600 font-mono">p1 (i-1):</span> <span className="font-bold">{prev1}</span></div>
                                <div className="flex justify-between gap-4"><span className="text-green-600 font-mono">curr (i):</span> <span className="font-bold">{currVal}</span></div>
                            </div>
                        )}

                        {/* Stairs Visualization */}
                        <div className="relative w-full max-w-2xl flex flex-col-reverse items-start gap-0 pl-10">
                            {Array.from({length: n}).map((_, i) => {
                                // é˜¶æ¢¯å¸ƒå±€ï¼šæ¯ä¸€çº§æ¯”ä¸Šä¸€çº§å®½ï¼Œæˆ–è€…ç”¨ margin-left
                                // è®©æˆ‘ä»¬å°è¯•ç»å…¸çš„é˜¶æ¢¯å½¢çŠ¶ï¼šæ¯ä¸ªç›’å­ä¸€æ ·å¤§ï¼Œä½†æ’åˆ—æˆé˜¶æ¢¯
                                const stepNum = i + 1;
                                const val = dp[i];
                                const isCurr = i === currentStep;

                                // åŠ¨æ€è®¡ç®—å®½åº¦/ä½ç½®
                                // ä½¿ç”¨ flex-row for each step row? No, simple absolute positioning or margins might be cleaner
                                // Let's use margin-left to create stairs

                                return (
                                    <div key={i} className="flex items-end">
                                        {/* Spacer for stair effect */}
                                        <div style={{ width: `${i * 30}px` }} className="h-2 transition-all duration-300"></div>

                                        {/* The Step Block */}
                                        <div className={`${getStepStyle(i)} w-24 h-16 rounded-sm shadow-sm flex flex-col z-10 stair-transition`}>
                                            {/* Step Number Label */}
                                            <span className="absolute top-1 left-2 text-[10px] text-slate-400 font-bold">Step {stepNum}</span>

                                            {/* Value (Ways) */}
                                            <span className={`text-xl font-bold ${val > 0 ? 'text-slate-700' : 'text-slate-300'}`}>
                                                    {val > 0 ? val : '?'}
                                                </span>

                                            {/* Character/Marker */}
                                            {isCurr && (
                                                <div className="absolute -right-8 bottom-0 animate-bounce">
                                                    ğŸš¶
                                                </div>
                                            )}

                                            {/* Reference Arrows (Visual only) */}
                                            {/* åªæœ‰å½“æ­£åœ¨è®¡ç®—å½“å‰æ ¼ï¼Œä¸”å½“å‰æ ¼å¤§äº2æ—¶æ˜¾ç¤ºæ¥æºç®­å¤´ */}
                                            {!isFinished && isCurr && stepNum > 2 && (
                                                <div className="absolute -left-6 bottom-[-30px] w-6 h-20 border-l-2 border-b-2 border-slate-300 rounded-bl-xl pointer-events-none opacity-50"></div>
                                            )}
                                        </div>

                                        {/* Annotations */}
                                        {val > 0 && (
                                            <div className="ml-4 mb-4 text-xs text-slate-500 font-mono bg-white/50 px-2 py-1 rounded fade-in-up">
                                                Ways: {val}
                                            </div>
                                        )}
                                    </div>
                                );
                            })}

                            {/* Ground Floor */}
                            <div className="w-full border-t-4 border-slate-300 mt-[-4px] relative">
                                <span className="absolute right-0 top-2 text-xs text-slate-400">Ground</span>
                            </div>
                        </div>

                    </div>

                    {/* Controls & Explanation */}
                    <div className="border-t border-slate-100 p-4 bg-white">
                        <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                            {/* Message */}
                            <div className="flex-1 bg-blue-50 text-blue-800 px-4 py-3 rounded-lg text-sm border-l-4 border-blue-500 w-full sm:w-auto whitespace-pre-line shadow-sm">
                                {message}
                            </div>

                            {/* Buttons */}
                            <div className="flex items-center gap-2">
                                <button onClick={() => setIsPlaying(!isPlaying)} disabled={isFinished} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-white font-medium transition ${isPlaying ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-600 hover:bg-blue-700'} disabled:opacity-50`}>
                                    {isPlaying ? <Icons.Pause /> : <Icons.Play />}
                                    <span className="hidden sm:inline">{isPlaying ? "æš‚åœ" : "è‡ªåŠ¨"}</span>
                                </button>
                                <button onClick={stepForward} disabled={isPlaying || isFinished} className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-medium transition disabled:opacity-50">
                                    <Icons.Step />
                                    <span className="hidden sm:inline">å•æ­¥</span>
                                </button>
                                <button onClick={() => init()} className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition">
                                    <Icons.Reset />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>